name: üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

on:
  push:
    branches:
      - main
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  deploy-backend:
    name: –î–µ–ø–ª–æ–π Backend (Railway)
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout –∫–æ–¥
        uses: actions/checkout@v4

      - name: üêç –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞..."
          python -m py_compile backend/**/*.py || true

      - name: üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          echo "üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          git diff --name-only HEAD~1 HEAD || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          echo ""
          echo "üì¶ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Railway"
          echo "Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏ push –≤ main"

  deploy-frontend:
    name: –î–µ–ø–ª–æ–π Frontend (Vercel)
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout –∫–æ–¥
        uses: actions/checkout@v4

      - name: üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        working-directory: ./frontend
        run: npm install

      - name: üî® –°–±–æ—Ä–∫–∞ frontend
        working-directory: ./frontend
        run: npm run build

      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
        working-directory: ./frontend
        run: |
          if [ ! -d "dist" ]; then
            echo "‚ùå –ü–∞–ø–∫–∞ dist –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
            exit 1
          fi
          echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞"

      - name: üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        run: |
          echo "üì¶ Frontend –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Vercel"
          echo "Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏ push –≤ main"

  notify:
    name: üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    runs-on: ubuntu-latest
    needs: [deploy-backend, deploy-frontend]
    if: always()
    steps:
      - name: ‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
        run: |
          echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
          echo "üöÄ Railway –∏ Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è"
          echo ""
          echo "üìù –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
          echo "  - Railway: https://railway.app"
          echo "  - Vercel: https://vercel.com"

