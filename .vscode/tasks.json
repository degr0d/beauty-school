{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Backend (Bot + API)",
            "type": "shell",
            "command": "${workspaceFolder}/venv/bin/python",
            "args": ["run_all.py"],
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "showReuseMessage": false,
                "clear": true
            },
            "runOptions": {
                "instanceLimit": 1
            },
            "isBackground": true
        },
        {
            "label": "Frontend (Vite)",
            "type": "shell",
            "command": "npm",
            "args": ["run", "dev"],
            "options": {
                "cwd": "${workspaceFolder}/frontend"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "showReuseMessage": false,
                "clear": true
            },
            "runOptions": {
                "instanceLimit": 1
            },
            "isBackground": true
        },
        {
            "label": "üîÑ Restart Frontend",
            "type": "shell",
            "command": "pkill -f 'node.*vite' || true; pkill -f 'npm.*dev' || true; pkill -f 'vite' || true; lsof -ti:5173 | xargs kill -9 2>/dev/null || true; sleep 2; cd ${workspaceFolder}/frontend && npm run dev > /dev/null 2>&1 &",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "clear": true
            }
        },
        {
            "label": "üöÄ Start All (Backend + Frontend)",
            "dependsOn": [
                "Backend (Bot + API)",
                "Frontend (Vite)"
            ],
            "dependsOrder": "parallel",
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "‚õî Stop All",
            "type": "shell",
            "command": "pkill -f 'python.*run_all.py' || true; pkill -f 'python.*run_bot_full.py' || true; pkill -f 'python.*run_api.py' || true; pkill -f 'uvicorn.*app' || true; pkill -f 'node.*vite' || true; pkill -f 'npm.*dev' || true; pkill -f 'vite' || true; lsof -ti:5173 | xargs kill -9 2>/dev/null || true; echo '‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–≤–∫–ª—é—á–∞—è Frontend –Ω–∞ –ø–æ—Ä—Ç—É 5173)'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "shared",
                "clear": true
            },
            "osx": {
                "command": "pkill -f 'python.*run_all.py' || true; pkill -f 'python.*run_bot_full.py' || true; pkill -f 'python.*run_api.py' || true; pkill -f 'uvicorn.*app' || true; pkill -f 'node.*vite' || true; pkill -f 'npm.*dev' || true; pkill -f 'vite' || true; lsof -ti:5173 | xargs kill -9 2>/dev/null || true; echo '‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–≤–∫–ª—é—á–∞—è Frontend –Ω–∞ –ø–æ—Ä—Ç—É 5173)'"
            },
            "windows": {
                "command": "taskkill /F /IM python.exe /T 2>nul & taskkill /F /IM node.exe /T 2>nul & echo –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
            }
        },
        {
            "label": "üê≥ Check Docker",
            "type": "shell",
            "command": "if ! docker info > /dev/null 2>&1; then echo '‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop.'; exit 1; fi; if ! docker-compose ps | grep -q 'Up'; then echo 'üöÄ –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...'; docker-compose up -d; sleep 5; fi; echo '‚úÖ Docker –≥–æ—Ç–æ–≤!'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "shared",
                "clear": false
            },
            "osx": {
                "command": "if ! docker info > /dev/null 2>&1; then echo '‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop.'; exit 1; fi; if ! docker-compose ps | grep -q 'Up'; then echo 'üöÄ –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...'; docker-compose up -d; sleep 5; fi; echo '‚úÖ Docker –≥–æ—Ç–æ–≤!'"
            },
            "windows": {
                "command": "docker info >nul 2>&1 || (echo Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop. && exit 1) && (docker-compose ps | findstr /C:\"Up\" >nul || (echo –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤... && docker-compose up -d && timeout /t 5 /nobreak >nul)) && echo Docker –≥–æ—Ç–æ–≤!"
            }
        },
        {
            "label": "üöÄ Prepare Launch",
            "dependsOn": ["‚õî Stop All", "üê≥ Check Docker"],
            "dependsOrder": "sequence",
            "problemMatcher": []
        },
        {
            "label": "üîÑ Restart All (Stop + Start)",
            "type": "shell",
            "command": "./restart_all.sh",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "dedicated",
                "clear": true
            },
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "üßπ Clean Cache",
            "type": "shell",
            "command": "python -Bc \"import pathlib; [p.unlink() for p in pathlib.Path('.').rglob('*.py[co]')]\"",
            "problemMatcher": []
        },
        {
            "label": "üì¶ Install Backend Dependencies",
            "type": "shell",
            "command": "pip install -r requirements.txt",
            "problemMatcher": []
        },
        {
            "label": "üì¶ Install Frontend Dependencies",
            "type": "shell",
            "command": "npm install",
            "options": {
                "cwd": "${workspaceFolder}/frontend"
            },
            "problemMatcher": []
        },
        {
            "label": "‚è≥ Wait for Frontend",
            "type": "shell",
            "command": "echo '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ Frontend...' && for i in {1..45}; do sleep 1; if lsof -ti:5173 > /dev/null 2>&1; then echo '‚úÖ Frontend –∑–∞–ø—É—â–µ–Ω!'; exit 0; fi; done; echo '‚ö†Ô∏è Frontend –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∑–∞ 45 —Å–µ–∫—É–Ω–¥'; exit 1",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "panel": "shared",
                "clear": false
            }
        },
    ]
}
